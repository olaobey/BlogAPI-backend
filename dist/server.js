"use strict";var ue=Object.create;var M=Object.defineProperty;var me=Object.getOwnPropertyDescriptor;var pe=Object.getOwnPropertyNames;var ye=Object.getPrototypeOf,fe=Object.prototype.hasOwnProperty;var we=(a,e,t,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of pe(e))!fe.call(a,r)&&r!==t&&M(a,r,{get:()=>e[r],enumerable:!(o=me(e,r))||o.enumerable});return a};var d=(a,e,t)=>(t=a!=null?ue(ye(a)):{},we(e||!a||!a.__esModule?M(t,"default",{value:a,enumerable:!0}):t,a));var s=(a,e,t)=>new Promise((o,r)=>{var c=g=>{try{y(t.next(g))}catch(p){r(p)}},l=g=>{try{y(t.throw(g))}catch(p){r(p)}},y=g=>g.done?o(g.value):Promise.resolve(g.value).then(c,l);y((t=t.apply(a,e)).next())});var ge=d(require("http"));var F=d(require("express")),se=d(require("dotenv")),ae=d(require("cors"));var E=d(require("winston"));var P=require("envalid"),U=d(require("dotenv"));U.default.config();var R=(0,P.cleanEnv)(process.env,{PORT:(0,P.num)({desc:"Port number for the application",default:5e3}),NODE_ENV:(0,P.str)({desc:"Node environment",default:"development"}),APP_LOG_LEVEL:(0,P.str)({desc:"Log level message",default:"info"})}),V=[`localhost:${process.env.PORT||5e3}`];var{combine:he,timestamp:ve,printf:Pe,colorize:Be}=E.default.format,be=E.default.createLogger({level:R.APP_LOG_LEVEL||"info",format:he(Be({all:!0}),ve({format:"YYYY-MM-DD hh:mm:ss.SSS A"}),Pe(a=>`[${a.timestamp}] ${a.level}: ${a.message}`)),transports:[new E.default.transports.Console]}),u=be;var D=d(require("fs")),Y=d(require("path")),G=d(require("app-root-path")),J=d(require("morgan"));function Ce(){let a=`${G.default}/logs`;D.default.existsSync(a)||D.default.mkdirSync(a);let e=D.default.createWriteStream(Y.default.join(a,"app-access.log"),{flags:"a"});return(0,J.default)("combined",{stream:e})}var W=Ce;var te=d(require("express"));var H=d(require("express")),B=require("express-validator");var N=d(require("express-paginate"));var z=require("@prisma/client"),Re=new z.PrismaClient,i=Re;var q=class{createBlogPost(e){return s(this,null,function*(){let{title:t,content:o,description:r}=e;return yield i.blog.create({data:{title:t,content:o,description:r}})})}updateBlogPost(e){return s(this,null,function*(){let{id:t,title:o,content:r,description:c}=e;return yield i.blog.update({where:{id:t},data:{title:o,content:r,description:c},include:{comments:!0,categories:!0}})})}getBlogPost(e){return s(this,null,function*(){return yield i.blog.findUnique({where:{id:e}})})}getBlogPostByTitle(e){return s(this,null,function*(){return yield i.blog.findFirst({where:{title:e}})})}getAllBlogPosts(r){return s(this,arguments,function*({skip:e,take:t,where:o}){return yield i.blog.findMany({skip:e,take:t,where:o,orderBy:{createdAt:"desc"}})})}likeBlogPost(e){return s(this,null,function*(){return yield i.blog.update({where:{id:e},data:{likesCount:{increment:1}}})})}viewBlogPost(e){return s(this,null,function*(){return yield i.blog.update({where:{id:e},data:{viewsCount:{increment:1}}})})}deleteBlogPost(e){return s(this,null,function*(){return yield i.blog.delete({where:{id:e}})})}deleteAllBlogPost(){return s(this,null,function*(){return yield i.blog.deleteMany()})}};var $=class extends Error{constructor(t="Unknown Error",o=500,r=void 0){super(t);this.status=o,this.data=r}static notFound(t="Credential Not Found",o=404){return new this(t,o)}static unauthorized(t="Sorry, you don't have the right permission to view the resources",o=403){return new this(t,o)}static unauthenticated(t="Sorry, you need to login first",o=401){return new this(t,o)}static badRequest(t="All fields are required",o=400,r=void 0){return new this(t,o,r)}static conflict(t="Duplicate blog title",o=409){return new this(t,o)}static serverError(t="Internal server error",o=500){return new this(t,o)}},n=$;var m=class m{static createBlogPost(e,t){return s(this,null,function*(){let{title:o,content:r,description:c}=e.body;if(!o||!r||!c)throw n.badRequest("All fields are required",400);try{if(yield m.blogService.getBlogPostByTitle(o))throw n.conflict("Duplicate blog title",409);let y=yield m.blogService.createBlogPost({title:o,content:r,description:c});t.status(200).json(y)}catch(l){throw n.serverError("Internal server error",500)}})}static getBlogPost(e,t){return s(this,null,function*(){let{id:o}=e.params;if(!o)throw n.notFound("No such post with id",404);try{let r=yield m.blogService.getBlogPost(o);if(!r)throw new n("Blog post not found",404);t.status(200).json({data:r,success:!0})}catch(r){throw n.serverError("Internal server error",500)}})}static getAllBlogPosts(e,t){return s(this,null,function*(){try{let o=parseInt(e.query.page,10)||1,r=parseInt(e.query.limit,10)||10,c=e.query.search,l=(o-1)*r,y=yield m.blogService.getAllBlogPosts({skip:l,take:r,where:{title:{contains:c}}}),g=yield i.blog.count(),p=Math.ceil(g/r),de={object:"list",has_more:N.default.hasNextPages(e)(p),data:y,pageCount:p,itemCount:g,currentPage:e.query.page,pages:N.default.getArrayPages(e)(3,p,o)};t.status(200).json({message:"Blogs retrieved successfully",data:de,success:!0})}catch(o){throw n.serverError("Internal server error",500)}})}static updateBlogPost(e,t){return s(this,null,function*(){let{id:o,title:r,content:c,description:l}=e.body;if(!o||!r||!c||!l)throw n.badRequest("All fields are required",400);try{if(!(yield m.blogService.getBlogPost(o)))throw n.notFound("Blog post not found",404);let g=yield m.blogService.getBlogPostByTitle(r);if(g&&(g==null?void 0:g.id.toString())!==o)throw n.conflict("Duplicate blog title",409);let p={id:o,title:r,content:c,description:l},L=yield m.blogService.updateBlogPost(p);t.status(200).json({message:"Blog post updated successfully",data:L,success:!0})}catch(y){throw n.serverError("Internal server error",500)}})}static likeBlogPost(e,t){return s(this,null,function*(){let{id:o}=e.params;if(!o)throw n.notFound("No such post with id",404);try{let r=yield m.blogService.likeBlogPost(o);t.status(200).json({data:r,success:!0})}catch(r){throw n.serverError("Internal server error",500)}})}static viewBlogPost(e,t){return s(this,null,function*(){let{id:o}=e.params;if(!o)throw n.notFound("No such post with id",404);try{let r=yield m.blogService.viewBlogPost(o);t.status(200).json({data:r,success:!0})}catch(r){throw n.serverError("Internal server error",500)}})}static deleteBlogPost(e,t){return s(this,null,function*(){let{id:o}=e.params;if(!o)throw n.notFound("No such post with id",404);try{let r=yield m.blogService.deleteBlogPost(o),c=`Blog '${r.title}' with ID ${r.id} has been successfully deleted`;t.status(200).json({data:c,success:!0})}catch(r){throw n.serverError("Internal server error",500)}})}static deleteAllBlogPost(e,t){return s(this,null,function*(){try{let o=yield m.blogService.deleteAllBlogPost();t.status(200).json({data:o,success:!0})}catch(o){throw n.serverError("Internal server error",500)}})}};m.blogService=new q;var f=m;var w=H.default.Router();w.route("/createBlog").post((0,B.body)("title").exists().isString(),(0,B.body)("content").exists().isString(),(0,B.body)("description").exists().isString(),f.createBlogPost);w.route("/updateBlog/:id").put((0,B.body)("title").isString().optional(),(0,B.body)("content").isString().optional(),(0,B.body)("description").isString().optional(),f.updateBlogPost);w.route("/getBlog/:id").get(f.getBlogPost);w.route("/getBlogs").get(f.getAllBlogPosts);w.route("/deleteBlog/:id").delete(f.deleteBlogPost);w.route("/deleteAllBlog").delete(f.deleteAllBlogPost);w.route("/likeBlog/:id").put(f.likeBlogPost);w.route("/viewBlog/:id").put(f.viewBlogPost);var Q=w;var X=d(require("express")),S=require("express-validator");var K=require("@prisma/client");var A=class{createCategory(e){return s(this,null,function*(){let{blogId:t,title:o,type:r}=e;if(!Object.values(K.CategoryType).includes(r))throw n.badRequest(`Invalid category type: ${r}`,400);let l=yield i.blog.findUnique({where:{id:t}});if(!l)throw n.notFound("Blog post not found",404);return yield i.category.create({data:{title:o,type:r,blog:{connect:{id:l.id}}}})})}updateCategory(e){return s(this,null,function*(){let{blogId:t,title:o,type:r}=e;if(!(yield i.blog.findMany({where:{id:t},include:{categories:!0,comments:!0}})).flatMap(p=>p.categories).find(p=>p.id===t))throw n.badRequest("Invalid category",400);return yield i.category.update({where:{id:e.id},data:{title:o,type:r}})})}getAllCategories(e){return s(this,null,function*(){return(yield i.blog.findMany({where:{id:e},include:{categories:!0,comments:!0}})).flatMap(r=>r.categories)})}getCategory(e){return s(this,null,function*(){return yield i.category.findUnique({where:{id:e}})})}deleteCategory(e){return s(this,null,function*(){return yield i.category.delete({where:{id:e}})})}};var h=class h{static createCategory(e,t){return s(this,null,function*(){let{blogId:o,title:r,type:c}=e.body;try{let l=yield h.categoryService.createCategory({blogId:o,title:r,type:c});t.status(200).json({message:"Category created successfully",data:l,success:!0})}catch(l){throw n.serverError("Internal server error",500)}})}static updateCategory(e,t){return s(this,null,function*(){try{let o=yield h.categoryService.updateCategory(e.body);t.status(200).json({message:"Updated category successfully",data:o,success:!0})}catch(o){throw n.serverError("Internal server error",500)}})}static getAllCategories(e,t){return s(this,null,function*(){let{blogId:o}=e.params;try{let r=yield h.categoryService.getAllCategories(o);t.status(200).json({message:"All categories successfully retrieved",data:r,success:!0})}catch(r){throw n.serverError("Internal server error",500)}})}static getCategory(e,t){return s(this,null,function*(){let{id:o}=e.params;try{let r=yield h.categoryService.getCategory(o);if(!r)throw n.notFound("Category not found",404);t.status(200).json({message:"Category successfully retrieved",data:r,success:!0})}catch(r){throw n.serverError("Internal server error",500)}})}static deleteCategory(e,t){return s(this,null,function*(){let{id:o}=e.params;try{let r=yield h.categoryService.deleteCategory(o);if(!r)throw n.notFound("Category not found",404);t.status(200).json({message:`Category '${r.title}' with ID '${r.id}' has been deleted`,data:r,success:!0})}catch(r){throw n.serverError("Internal server error",500)}})}};h.categoryService=new A;var v=h;var C=X.default.Router();C.route("/createCategory").post((0,S.body)("blogId").exists().isString(),(0,S.body)("title").exists().isString().isIn(["politics","national","world","entertainment","technology","business"," All"]).optional(),v.createCategory);C.route("/updateCategory/:id").put((0,S.body)("title").isString().optional(),(0,S.body)("status").isIn(["politics","national","world","entertainment","technology","business"," All"]).optional(),v.updateCategory);C.route("/category/:id").get(v.getCategory);C.route("/categories").get(v.getAllCategories);C.route("/deleteCategory/:id").delete(v.deleteCategory);var Z=C;var _=d(require("express")),T=require("express-validator");var j=class{createComment(e){return s(this,null,function*(){let{blogId:t,content:o}=e,r=yield i.blog.findUnique({where:{id:t}});if(!r)throw new Error("Blog post not found");return yield i.comment.create({data:{content:o,blog:{connect:{id:r.id}}}})})}deleteComment(e){return s(this,null,function*(){return yield i.comment.delete({where:{id:e}})})}};var I=class I{static createComment(e,t){return s(this,null,function*(){let{blogId:o,content:r}=e.body;try{let c=yield I.commentService.createComment({blogId:o,content:r});t.status(200).json({message:"Comment created successfully",data:c,success:!0})}catch(c){throw n.serverError("Internal server error",500)}})}static deleteComment(e,t){return s(this,null,function*(){let{id:o}=e.params;try{let r=yield I.commentService.deleteComment(o);if(!r)throw n.notFound("Comment not found",404);t.status(200).json({message:`Comment with ID '${r.id}' has been deleted successfully`,data:r,success:!0})}catch(r){throw n.serverError("Internal server error",500)}})}};I.commentService=new j;var x=I;var k=_.default.Router();k.route("/addComment").post((0,T.body)("blogId").exists().isString(),(0,T.body)("content").exists().isString(),x.createComment);k.route("/deleteComment/:id").delete(x.deleteComment);var ee=k;var O=te.default.Router();O.use("/blog",Q);O.use("/category",Z);O.use("/comment",ee);var oe=O;var re=(a,e,t,o)=>{u.error(a),a instanceof n?t.status(a.status).json({msg:a.message,success:!1,data:a.data}):t.status(500).json({msg:"Unknown Error Occurred",success:!1})};se.default.config();var b=(0,F.default)();b.use((0,ae.default)({origin:(a,e)=>(u.info(JSON.stringify({origin:a,whitelists:V}),"Cors Info"),e(null,!0)),credentials:!0}));b.use(W());b.use(F.default.json());b.use(F.default.urlencoded({extended:!0}));b.use("/api/v1",oe);b.use(re);var ne=b;var ie=()=>s(void 0,null,function*(){try{yield i.$disconnect(),u.info("Database disconnected Successfully")}catch(a){u.error(a)}}),ce=()=>s(void 0,null,function*(){try{yield i.$connect(),u.info("Database Connected Successfully")}catch(a){u.error(a)}});var le=ge.default.createServer(ne),Se=()=>s(exports,null,function*(){try{yield ce(),le.listen(R.PORT,()=>{u.info(`\u26A1\uFE0F[server]: Server running on port at http://localhost:${R.PORT}`)}),le.on("close",()=>s(exports,null,function*(){try{yield ie(),u.info("Database disconnected")}catch(a){u.error("Error disconnecting database:",a)}}))}catch(a){u.error(a)}});Se();
